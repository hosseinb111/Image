<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="chat-container">
        <div id="messages"></div>
        <input id="username" placeholder="Enter your username" required />
        <input id="message" placeholder="Type a message" required />
        <button id="send">Send</button>
    </div>
    <script src="chat.js"></script>
</body>
</html>

// chat.js
const API_KEY = process.env.SUPABASE_API_KEY; // Use environment variable

// Utility function for sanitization 
const sanitizeInput = (input) => {
    const tempDiv = document.createElement('div');
    tempDiv.textContent = input;
    return tempDiv.innerHTML;
};

const validateInput = (username, message) => {
    const usernameRegex = /^[a-zA-Z0-9]{3,20}$/; // Username validation regex 
    const messageRegex = /^.{1,500}$/; // Message length validation
    return usernameRegex.test(username) && messageRegex.test(message);
};

const debounce = (func, delay) => {
    let timeoutId;
    return (...args) => {
        if (timeoutId) clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            func.apply(null, args);
        }, delay);
    };
};

const sendMessage = async () => {
    try {
        const username = sanitizeInput(document.getElementById('username').value);
        const message = sanitizeInput(document.getElementById('message').value);
        if (!validateInput(username, message)) {
            throw new Error('Invalid input.');
        }
        // Send message to server...
    } catch (error) {
        console.error('Error sending message:', error);
    }
};

document.getElementById('send').addEventListener('click', debounce(sendMessage, 300));

// Cleanup listeners to prevent memory leaks
window.addEventListener('beforeunload', () => {
    document.getElementById('send').removeEventListener('click', sendMessage);
});
